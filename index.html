<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <meta name="theme-color" content="#0f172a" />
    <title>Ezra's Money Machine</title>
    <meta name="description" content="A financial learning tool for Ezra by Taitt Fin." />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React and ReactDOM UMD builds -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel in-browser JSX transform -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        :root { --bg: #0f172a; }
        html, body {
            background-color: var(--bg);
            color: white;
            height: 100%;
            margin: 0;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }

        /* Slider thumb styling */
        .slider-thumb::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 28px;
            height: 28px;
            background: #fbbf24;
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 2px 6px rgba(0,0,0,0.35);
            border: 2px solid rgba(0,0,0,0.12);
        }
        .slider-thumb::-moz-range-thumb {
            width: 28px;
            height: 28px;
            background: #fbbf24;
            border-radius: 50%;
            border: none;
        }
        @media (pointer: coarse) {
            .slider-thumb::-webkit-slider-thumb { width: 36px; height: 36px; }
            .slider-thumb::-moz-range-thumb { width: 36px; height: 36px; }
        }

        /* Focus outline for accessibility */
        .focus-ring:focus {
            outline: 3px solid rgba(99,102,241,0.28);
            outline-offset: 2px;
        }

        /* Small fade-in animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-in { animation: fadeIn 0.45s ease-out forwards; }

        /* Progress bar animation (width) */
        .progress-anim { transition: width 520ms cubic-bezier(.2,.9,.25,1); }

        /* Total pop animation */
        .pop {
            transform-origin: center;
            transition: transform 300ms ease-out;
        }
        .pop.pulse {
            transform: scale(1.06);
        }

        /* Tooltip styling */
        .slider-wrapper { position: relative; }
        .slider-tooltip {
            position: absolute;
            top: -44px;
            transform: translateX(-50%);
            background: rgba(15,23,42,0.95);
            color: #f8fafc;
            padding: 6px 9px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 13px;
            box-shadow: 0 6px 18px rgba(2,6,23,0.6);
            white-space: nowrap;
            pointer-events: none;
            z-index: 40;
        }
        .slider-tooltip:after {
            content: "";
            position: absolute;
            left: 50%;
            bottom: -6px;
            transform: translateX(-50%);
            border-width: 6px 6px 0 6px;
            border-style: solid;
            border-color: rgba(15,23,42,0.95) transparent transparent transparent;
        }

        /* Touch target improvements for rows */
        .tap-row { padding: 0.85rem; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // SVG icons (accept props)
        const Rocket = (props) => (
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={1.8} strokeLinecap="round" strokeLinejoin="round" {...props}>
                <path d="M12 2c2 0 4 1 6 3s3 4 3 6c0 4-4 8-10 14-6-6-10-10-10-14 0-2 1-4 3-6s4-3 6-3z" />
                <path d="M12 7v5" />
                <path d="M9 14c1 1 3 1 4 0" />
            </svg>
        );

        const Clock = (props) => (
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={1.8} strokeLinecap="round" strokeLinejoin="round" {...props}>
                <circle cx="12" cy="12" r="10" />
                <polyline points="12 6 12 12 16 14" />
            </svg>
        );

        const TrendingUp = (props) => (
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={1.8} strokeLinecap="round" strokeLinejoin="round" {...props}>
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18" />
                <polyline points="17 6 23 6 23 12" />
            </svg>
        );

        const Zap = (props) => (
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={1.8} strokeLinecap="round" strokeLinejoin="round" {...props}>
                <polygon points="13 2 3 14 12 14 11 22 21 10 13 10 13 2" />
            </svg>
        );

        // Card & rule components
        const Card = ({ children, className = "" }) => (
            <div className={`bg-slate-800 rounded-2xl border border-slate-700 p-4 sm:p-6 shadow-xl ${className}`}>
                {children}
            </div>
        );

        const CoinRule = ({ percentage, coinName, coinColor, emoji, description, value }) => (
            <div className="tap-row flex items-center gap-4 bg-slate-900/50 rounded-xl border border-slate-700/50 mb-3 hover:border-yellow-400/50 transition-all cursor-pointer group">
                <div className="flex flex-col items-center justify-center w-16">
                    <div className={`w-12 h-12 rounded-full flex items-center justify-center text-2xl shadow-lg ${coinColor} group-hover:scale-110 transition-transform`}>
                        {percentage > 0 ? '$' : '‚ùå'}
                    </div>
                    <span className="text-xs text-slate-400 mt-1 font-mono">{percentage}%</span>
                </div>

                <div className="flex-1">
                    <div className="flex justify-between items-center">
                        <h4 className="font-bold text-white text-base sm:text-lg">{coinName} Rule</h4>
                        <span className="text-xl sm:text-2xl">{emoji}</span>
                    </div>
                    <p className="text-slate-300 text-sm leading-snug">{description}</p>
                    <div className="mt-2 text-xs font-mono text-yellow-400 bg-yellow-400/10 inline-block px-2 py-1 rounded">
                        For every $1.00 ‚Üí You get a {value}
                    </div>
                </div>
            </div>
        );

        // Main App
        function EzraMoneyApp() {
            const minAge = 6;
            const maxAge = 18;

            const [activeTab, setActiveTab] = React.useState('timeMachine');
            const [age, setAge] = React.useState(minAge);
            const [dragging, setDragging] = React.useState(false);
            const [tooltipLeftPct, setTooltipLeftPct] = React.useState(0);
            const [tooltipVisible, setTooltipVisible] = React.useState(false);
            const [animateTotal, setAnimateTotal] = React.useState(false);

            const inputRef = React.useRef(null);
            const sliderWrapperRef = React.useRef(null);

            // Initial Balances
            const initialBalances = {
                chase: 134.01,
                savings: 1202.46,
                cd: 520.00,
                roth: 1081.64
            };

            const yearsPassed = Math.max(0, age - 6);

            // Compound growth
            const currentValues = {
                chase: initialBalances.chase, // 0%
                savings: initialBalances.savings * Math.pow(1.01, yearsPassed), // 1%
                cd: initialBalances.cd * Math.pow(1.05, yearsPassed), // 5%
                roth: initialBalances.roth * Math.pow(1.25, yearsPassed) // 25%
            };

            const totalMoney = Object.values(currentValues).reduce((a, b) => a + b, 0);
            const profit = totalMoney - 2938.11;

            const fmt = (num) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(num);

            // percent helper for progress bars
            const pct = (val) => {
                if (!totalMoney || totalMoney <= 0) return 0;
                return Math.max(1, Math.round((val / totalMoney) * 100));
            };

            // Update tooltip position based on current age
            const updateTooltipPosition = React.useCallback((ageVal = age) => {
                if (!inputRef.current) return;
                const el = inputRef.current;
                const rect = el.getBoundingClientRect();
                const pctPos = (ageVal - minAge) / (maxAge - minAge);
                // left percentage will be used with translateX(-50%) to center
                const leftPct = Math.min(100, Math.max(0, pctPos * 100));
                setTooltipLeftPct(leftPct);
            }, [age]);

            // Show tooltip when user starts interacting (pointer down or focus)
            const handlePointerDown = (e) => {
                setDragging(true);
                setTooltipVisible(true);
                // capture pointer on the input to receive pointermove/up
                try { e.target.setPointerCapture(e.pointerId); } catch (err) {}
                updateTooltipPosition();
            };

            const handlePointerUp = (e) => {
                setDragging(false);
                // keep visible for a short moment then hide
                window.setTimeout(() => setTooltipVisible(false), 650);
                try { e.target.releasePointerCapture && e.target.releasePointerCapture(e.pointerId); } catch (err) {}
            };

            // Update age on change and animate totals
            const handleChange = (e) => {
                const newAge = parseInt(e.target.value, 10);
                setAge(newAge);
                updateTooltipPosition(newAge);

                // trigger small pop animation on total
                setAnimateTotal(true);
                window.setTimeout(() => setAnimateTotal(false), 320);
            };

            // Keep tooltip positioned if age changes programmatically
            React.useEffect(() => {
                updateTooltipPosition();
            }, [age, updateTooltipPosition]);

            // Ensure tooltip hides if user taps elsewhere
            React.useEffect(() => {
                const onUp = () => {
                    setDragging(false);
                    window.setTimeout(() => setTooltipVisible(false), 650);
                };
                window.addEventListener('pointerup', onUp);
                return () => window.removeEventListener('pointerup', onUp);
            }, []);

            // Ensure initial tooltip position
            React.useEffect(() => updateTooltipPosition(), []);

            return (
                <div className="min-h-screen bg-slate-900 text-white font-sans pb-24">
                    <header className="bg-slate-900 border-b border-slate-800 sticky top-0 z-20">
                        <div className="w-full max-w-full sm:max-w-md mx-auto px-4 sm:px-6 h-16 flex items-center justify-between">
                            <div className="flex items-center gap-3 min-w-0">
                                <img
                                    src="taitt_fin_horizontal_banner.png"
                                    alt="Taitt Fin"
                                    className="h-9 w-auto object-contain hidden sm:block"
                                    onError={(e) => { e.currentTarget.style.display = 'none'; }}
                                    loading="lazy"
                                />
                                <div className="sm:hidden w-8 h-8 bg-gradient-to-tr from-yellow-400 to-orange-500 rounded-full flex items-center justify-center text-slate-900 font-bold">E</div>
                                <span className="font-bold text-lg tracking-tight truncate">Ezra's Money Machine</span>
                            </div>

                            <div className="text-sm font-medium bg-slate-800 px-3 py-1 rounded-full border border-slate-700">
                                Age: <span className="text-yellow-400">{age}</span>
                            </div>
                        </div>
                    </header>

                    <main className="w-full max-w-full sm:max-w-md mx-auto px-4 py-6 space-y-6">
                        <div className="grid grid-cols-2 gap-2 bg-slate-800 p-1 rounded-xl">
                            <button
                                onClick={() => setActiveTab('timeMachine')}
                                className={`py-3 text-base rounded-lg font-bold transition-all focus-ring ${activeTab === 'timeMachine' ? 'bg-indigo-600 text-white shadow-lg' : 'text-slate-300 hover:text-white'}`}
                                aria-pressed={activeTab === 'timeMachine'}
                            >
                                Time Machine
                            </button>
                            <button
                                onClick={() => setActiveTab('infographic')}
                                className={`py-3 text-base rounded-lg font-bold transition-all focus-ring ${activeTab === 'infographic' ? 'bg-indigo-600 text-white shadow-lg' : 'text-slate-300 hover:text-white'}`}
                                aria-pressed={activeTab === 'infographic'}
                            >
                                Coin Rules
                            </button>
                        </div>

                        {activeTab === 'infographic' ? (
                            <div className="animate-in">
                                <h2 className="text-2xl font-bold mb-2 text-center">How Your Money Grows</h2>
                                <p className="text-slate-400 text-center mb-4 text-sm">Every year, your money makes "baby money." The rule depends on where the money lives!</p>

                                <CoinRule
                                    percentage={0}
                                    coinName="The Zero"
                                    description="Checking Account. Money sleeps; it doesn't grow."
                                    emoji="üò¥"
                                    value="Nothing (0¬¢)"
                                    coinColor="bg-slate-600 text-slate-400"
                                />
                                <CoinRule
                                    percentage={1}
                                    coinName="The Penny"
                                    description="Savings Account. Every dollar gives you a tiny penny."
                                    emoji="ü•â"
                                    value="Penny (1¬¢)"
                                    coinColor="bg-orange-700 text-orange-200 border-2 border-orange-600"
                                />
                                <CoinRule
                                    percentage={5}
                                    coinName="The Nickel"
                                    description="Trax CD. Now we are talking! A shiny nickel."
                                    emoji="ü•à"
                                    value="Nickel (5¬¢)"
                                    coinColor="bg-slate-300 text-slate-600 border-2 border-slate-400"
                                />
                                <CoinRule
                                    percentage={25}
                                    coinName="The Quarter"
                                    description="Roth IRA. This is the magic machine! Big quarters!"
                                    emoji="üöÄ"
                                    value="Quarter (25¬¢)"
                                    coinColor="bg-yellow-400 text-yellow-900 border-4 border-yellow-200"
                                />
                            </div>
                        ) : (
                            <div className="space-y-6">
                                <Card className="bg-gradient-to-b from-indigo-900 to-slate-900 border-indigo-500/30">
                                    <div className="flex items-center justify-between mb-3">
                                        <h3 className="font-bold text-indigo-300 flex items-center gap-2 text-base sm:text-lg">
                                            <Clock className="w-5 h-5 text-indigo-300" /> Time Machine
                                        </h3>
                                        <span className="text-xs bg-indigo-500/20 text-indigo-300 px-2 py-1 rounded">Drag to grow</span>
                                    </div>

                                    <div className="relative pt-4 pb-1 slider-wrapper" ref={sliderWrapperRef}>
                                        {/* Tooltip positioned absolutely using left % */}
                                        {tooltipVisible && (
                                            <div
                                                className="slider-tooltip"
                                                style={{ left: `${tooltipLeftPct}%` }}
                                                role="status"
                                                aria-live="polite"
                                            >
                                                {fmt(totalMoney)}
                                            </div>
                                        )}

                                        <input
                                            ref={inputRef}
                                            type="range"
                                            min={minAge}
                                            max={maxAge}
                                            step="1"
                                            value={age}
                                            onChange={handleChange}
                                            onPointerDown={handlePointerDown}
                                            onPointerUp={handlePointerUp}
                                            onFocus={() => { setTooltipVisible(true); updateTooltipPosition(); }}
                                            onBlur={() => { if (!dragging) setTooltipVisible(false); }}
                                            className="w-full h-4 bg-slate-700 rounded-lg appearance-none cursor-pointer slider-thumb focus-ring"
                                            aria-label="Choose an age to see growth"
                                        />
                                        <div className="flex justify-between mt-2 text-xs font-mono text-slate-400">
                                            <span>Age 6</span><span>Age 12</span><span>Age 18</span>
                                        </div>
                                        <div className="mt-4 text-center">
                                            <span className={`text-3xl sm:text-4xl font-black text-white drop-shadow-lg pop ${animateTotal ? 'pulse' : ''}`}>Age {age}</span>
                                            <div className="text-indigo-400 text-sm font-bold">
                                                {yearsPassed === 0 ? "Today" : `${yearsPassed} years later`}
                                            </div>
                                        </div>
                                    </div>
                                </Card>

                                <div className="text-center py-2">
                                    <div className="text-slate-400 text-sm uppercase tracking-wider font-bold mb-1">Total Wealth</div>
                                    <div className="text-4xl sm:text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-emerald-600 tracking-tight pop">
                                        <span className={`${animateTotal ? 'pulse' : ''}`}>{fmt(totalMoney)}</span>
                                    </div>
                                    {yearsPassed > 0 && (
                                        <div className="inline-flex items-center gap-2 bg-green-900/30 text-green-400 px-3 py-1 rounded-full text-sm font-bold mt-2 border border-green-800">
                                            <TrendingUp className="w-4 h-4 text-green-400" /> You made +{fmt(profit)} for doing nothing!
                                        </div>
                                    )}
                                </div>

                                <div className="grid gap-3">
                                    {/* Chase */}
                                    <div className="bg-slate-800 p-3 sm:p-4 rounded-xl border-l-4 border-slate-500 flex items-center gap-3 tap-row">
                                        <div className="w-10 h-10 bg-slate-700 rounded-full flex items-center justify-center text-xl">üê∑</div>
                                        <div className="flex-1">
                                            <div className="flex justify-between font-bold text-sm sm:text-base">
                                                <span className="text-slate-300">Chase (0%)</span>
                                                <span className="text-slate-400">{fmt(currentValues.chase)}</span>
                                            </div>
                                            <div className="h-3 bg-slate-700 rounded-full mt-2 overflow-hidden">
                                                <div className="h-full bg-slate-500 progress-anim" style={{width: `${pct(currentValues.chase)}%`}}></div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Savings */}
                                    <div className="bg-slate-800 p-3 sm:p-4 rounded-xl border-l-4 border-orange-500 flex items-center gap-3 tap-row">
                                        <div className="w-10 h-10 bg-orange-900/50 rounded-full flex items-center justify-center text-xl">üå±</div>
                                        <div className="flex-1">
                                            <div className="flex justify-between font-bold text-sm sm:text-base">
                                                <span className="text-orange-200">Savings (1%)</span>
                                                <span className="text-orange-400">{fmt(currentValues.savings)}</span>
                                            </div>
                                            <div className="h-3 bg-slate-700 rounded-full mt-2 overflow-hidden">
                                                <div className="h-full bg-orange-500 transition-all duration-500 progress-anim" style={{width: `${pct(currentValues.savings)}%`}}></div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* CD */}
                                    <div className="bg-slate-800 p-3 sm:p-4 rounded-xl border-l-4 border-blue-500 flex items-center gap-3 tap-row">
                                        <div className="w-10 h-10 bg-blue-900/50 rounded-full flex items-center justify-center text-xl">üîí</div>
                                        <div className="flex-1">
                                            <div className="flex justify-between font-bold text-sm sm:text-base">
                                                <span className="text-blue-200">Trax CD (5%)</span>
                                                <span className="text-blue-400">{fmt(currentValues.cd)}</span>
                                            </div>
                                            <div className="h-3 bg-slate-700 rounded-full mt-2 overflow-hidden">
                                                <div className="h-full bg-blue-500 transition-all duration-500 progress-anim" style={{width: `${pct(currentValues.cd)}%`}}></div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Roth IRA */}
                                    <div className="relative bg-gradient-to-r from-indigo-900 to-purple-900 p-3 sm:p-4 rounded-xl border border-indigo-500/50 shadow-lg overflow-hidden tap-row">
                                        <div className="relative z-10 flex items-center gap-3">
                                            <div className="w-10 h-10 bg-yellow-400 rounded-full flex items-center justify-center text-xl shadow-lg animate-pulse">
                                                <Rocket className="w-5 h-5 text-yellow-900" />
                                            </div>
                                            <div className="flex-1">
                                                <div className="flex justify-between font-bold items-end text-sm sm:text-base">
                                                    <span className="text-white">Roth IRA (25%)</span>
                                                    <span className="text-2xl text-yellow-300">{fmt(currentValues.roth)}</span>
                                                </div>
                                                <div className="h-3 bg-slate-900/50 rounded-full mt-2 overflow-hidden border border-white/10">
                                                    <div className="h-full bg-gradient-to-r from-yellow-400 to-yellow-600 progress-anim" style={{width: `${pct(currentValues.roth)}%`}}></div>
                                                </div>
                                                <div className="text-[10px] text-indigo-200 mt-2 flex items-center gap-1 font-bold">
                                                    <Zap className="w-3 h-3 text-yellow-400" /> ROCKET MONEY! <span className="ml-1 text-xs text-yellow-200">Big growth</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        )}
                        <footer className="text-center mt-6 text-slate-600 text-xs">
                            <p>Created by Taitt Fin for Ezra</p>
                        </footer>
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<EzraMoneyApp />);
    </script>
</body>
</html>